# 最終セットアップステップ

## ✅ 完了した項目

- [x] `user_profiles` テーブルが存在する
- [x] `inquiries` テーブルが存在する
- [x] `documents` テーブルが存在する
- [x] すべてのテーブルでRLSが有効
- [x] すべてのテーブルに十分なポリシーが設定されている
- [x] Storage バケット `documents` が作成されている
- [x] Storage バケット `documents` のポリシーが設定されている

## 📋 次のステップ

### ステップ1: スキーマキャッシュのリフレッシュ

1. **Supabase Dashboard → Settings → API** を開く
2. **「Reload schema cache」** または **「Refresh schema」** ボタンをクリック
3. **数秒待つ**（キャッシュが更新されるまで）

### ステップ2: 動作確認

#### 2-1. お問い合わせ機能の確認

1. **アプリケーションにログイン**
2. **「📧 お問い合わせ」ボタン**をクリック
3. **件名とメッセージを入力**して送信
4. **エラーが出ないか確認**
   - ✅ 成功: 「送信成功」などのメッセージが表示される
   - ❌ エラー: エラーメッセージを確認

#### 2-2. 規約閲覧機能の確認

1. **「📄 規約閲覧」ボタン**をクリック
2. **資料一覧が表示されるか確認**
   - まだ資料がない場合は、空のリストが表示されます（正常です）

#### 2-3. 資料アップロード機能の確認（管理者のみ）

1. **管理者でログイン**（`mitamuraka@haguroko.ed.jp` または `tomonoem@haguroko.ed.jp`）
2. **管理者ダッシュボード → 「📄 資料管理」**をクリック
3. **PDFファイルをアップロード**してみる
   - タイトルを入力
   - PDFファイルを選択
   - 「アップロード」ボタンをクリック
4. **エラーが出ないか確認**
   - ✅ 成功: 「アップロードが完了しました」というメッセージが表示される
   - ❌ エラー: エラーメッセージを確認

#### 2-4. 資料ダウンロード機能の確認

1. **「📄 規約閲覧」ページ**を開く
2. **アップロードした資料が表示されるか確認**
3. **「ダウンロード」ボタンをクリック**
4. **PDFファイルがダウンロードされるか確認**

### ステップ3: エラーが出た場合の対処

#### エラー: 「スキーマキャッシュが更新されていません」（PGRST205）

**解決方法**:
1. ステップ1（スキーマキャッシュのリフレッシュ）を実行
2. 数分待ってから再度試す

#### エラー: 「Bucket not found」

**解決方法**:
1. Storage → Files → Buckets で `documents` バケットが存在するか確認
2. 存在しない場合は作成

#### エラー: 「permission denied」または「new row violates row-level security policy」

**解決方法**:
1. Storage → Files → Policies → Buckets で `documents` バケットのポリシーが正しく設定されているか確認
2. 不足している場合は追加

## 🎉 セットアップ完了の確認

以下のすべてが正常に動作すれば、セットアップは完了です：

- [ ] お問い合わせ機能が動作する
- [ ] 規約閲覧機能が動作する（資料がない場合は空のリストが表示される）
- [ ] 資料アップロード機能が動作する（管理者のみ）
- [ ] 資料ダウンロード機能が動作する

## 📝 今後の運用

### 管理者向け

1. **PDF資料のアップロード**
   - 管理者ダッシュボード → 「📄 資料管理」
   - 新しい規約や資料をアップロード

2. **お問い合わせの確認**
   - 管理者ダッシュボード → 「📧 お問い合わせ管理」
   - ユーザーからの問い合わせを確認・対応

### 一般ユーザー向け

1. **規約の閲覧**
   - メイン画面 → 「📄 規約閲覧」
   - アップロードされたPDF資料をダウンロード

2. **お問い合わせの送信**
   - メイン画面 → 「📧 お問い合わせ」
   - システムに関する質問や不具合を報告

## 🆘 トラブルシューティング

問題が発生した場合は、以下を確認してください：

1. **ブラウザのコンソール**（F12 → Console）
2. **エラーメッセージ**（画面に表示されたもの）
3. **Supabase Dashboard のログ**（Logs セクション）

## 📚 参考資料

- `SETUP_INQUIRIES_AND_DOCUMENTS.md` - セットアップガイド
- `COMPLETE_SETUP_GUIDE.md` - 完全なセットアップガイド
- `STORAGE_POLICY_UI_FIX.md` - Storageポリシー設定ガイド
